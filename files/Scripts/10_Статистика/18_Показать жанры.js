//------------------------------------------------------------------------------------------
//  Скрипт «Показать жанры»
//  предназначен для расшифровки кодов жанра
//  тестировался в FBE v.2.7.7 (win XP, IE8 и win 7, IE11)
//------------------------------------------------------------------------------------------
// v.1.0 — Создание скрипта — Александр Ка (16.03.2025)
//------------------------------------------------------------------------------------------

function Run() {

 var NumerusVersion="1.0";

// ---------------------------------------------------
// ------------------------------------
// ---------------------


                 /// ОБЩИЕ ПЕРЕМЕННЫЕ

         //  Счетчики цикла
var j = 0;
var k = 0;

 var fbwDesc=document.getElementById("fbw_desc");         //  Структура дискрипшена.
 var mDesc=fbwDesc.all;         //  Все разделы дискрипшена.

 var Dobavlenie = true;                   //  Индикатор для добавления названий на панель "Описания документа".
 if (fbwDesc.style.display == "none")  Dobavlenie = false;   //  Если панель "Описания документа" выключена - добавление тоже отключается.

// ---------------------------------------------------
// ------------------------------------
// ---------------------


                 /// МАССИВЫ УНИВЕРСАЛЬНОГО СПИСКА ЖАНРОВ

 var mCodeGenre = ["accounting", "adv_animal", "adv_geo", "adv_history", "adv_indian", "adv_maritime", "adv_modern", "adv_story", "adv_western", "adventure", "antique", "antique_ant", "antique_east", "antique_european", "antique_myths", "antique_russian", "aphorisms", "architecture_book", "art_criticism", "art_world_culture", "astrology", "auto_business", "auto_regulations", "banking", "child_adv", "child_classical", "child_det", "child_education", "child_folklore", "child_prose", "child_sf", "child_tale", "child_tale_rus", "child_verse", "children", "cine", "comedy", "comics", "comp_db", "comp_dsp", "comp_hard", "comp_osnet", "comp_programming", "comp_soft", "comp_www", "computers", "design", "det_action", "det_classic", "det_cozy", "det_crime", "det_espionage", "det_hard", "det_history", "det_irony", "det_maniac", "det_police", "det_political", "det_su", "detective", "diafilm", "dissident", "drama", "drama_antique", "dramaturgy", "economics", "economics_ref", "epic", "epic_poetry", "epistolary_fiction", "equ_history", "essay", "experimental_poetry", "extravaganza", "fable", "fairy_fantasy", "family", "fanfiction", "folk_songs", "folk_tale", "folklore", "foreign_antique", "foreign_children", "foreign_language", "foreign_prose", "geo_guides", "global_economy", "gothic_novel", "great_story", "historical_fantasy", "home", "home_collecting", "home_cooking", "home_crafts", "home_diy", "home_entertain", "home_garden", "home_health", "home_pets", "home_sex", "home_sport", "hronoopera", "humor", "humor_anecdote", "humor_fantasy", "humor_prose", "humor_satire", "humor_verse", "in_verse", "industries", "job_hunting", "limerick", "literature_18", "literature_19", "literature_20", "love", "love_contemporary", "love_detective", "love_erotica", "love_hard", "love_history", "love_sf", "love_short", "lyrics", "management", "marketing", "military", "military_arts", "military_history", "military_special", "military_weapon", "modern_tale", "music", "mystery", "network_literature", "nonf_biography", "nonf_criticism", "nonf_military", "nonf_publicism", "nonfiction", "notes", "nsf", "org_behavior", "other", "painting", "palindromes", "palmistry", "paper_work", "periodic", "personal_finance", "poem", "poetry", "poetry_classical", "poetry_east", "poetry_for_classical", "poetry_for_modern", "poetry_modern", "poetry_rus_classical", "poetry_rus_modern", "popadancy", "popadanec", "popular_business", "prose", "prose_abs", "prose_classic", "prose_contemporary", "prose_counter", "prose_epic", "prose_game", "prose_history", "prose_magic", "prose_military", "prose_neformatny", "prose_rus_classic", "prose_sentimental", "prose_su_classics", "proverbs", "psy_childs", "psy_sex_and_family", "psy_theraphy", "real_estate", "ref_dict", "ref_encyc", "ref_guide", "ref_ref", "reference", "religion", "religion_budda", "religion_catholicism", "religion_christianity", "religion_esoterics", "religion_hinduism", "religion_islam", "religion_judaism", "religion_orthodoxy", "religion_paganism", "religion_protestantism", "religion_rel", "religion_self", "riddles", "roman", "russian_fantasy", "sagas", "scenarios", "sci_abstract", "sci_anachem", "sci_biochem", "sci_biology", "sci_biophys", "sci_botany", "sci_build", "sci_business", "sci_chem", "sci_cosmos", "sci_crib", "sci_culture", "sci_ecology", "sci_economy", "sci_geo", "sci_history", "sci_juris", "sci_linguistic", "sci_math", "sci_medicine", "sci_medicine_alternative", "sci_metal", "sci_orgchem", "sci_oriental", "sci_pedagogy", "sci_philology", "sci_philosophy", "sci_phys", "sci_physchem", "sci_politics", "sci_popular", "sci_psychology", "sci_radio", "sci_religion", "sci_social_studies", "sci_state", "sci_tech", "sci_textbook", "sci_theories", "sci_transport", "sci_veterinary", "sci_zoo", "science", "screenplays", "sf", "sf_action", "sf_cyberpunk", "sf_detective", "sf_epic", "sf_etc", "sf_fantasy", "sf_fantasy_city", "sf_fantasy_irony", "sf_heroic", "sf_history", "sf_horror", "sf_humor", "sf_irony", "sf_litrpg", "sf_mystic", "sf_postapocalyptic", "sf_social", "sf_space", "sf_space_opera", "sf_stimpank", "sf_technofantasy", "short_story", "small_business", "song_poetry", "stock", "story", "tale_chivalry", "tbg_computers", "tbg_higher", "tbg_school", "tbg_secondary", "theatre", "thriller", "thriller_legal", "thriller_medical", "thriller_psychology", "thriller_techno", "trade", "tragedy", "travel_notes", "unfinished", "vaudeville", "vers_libre", "visual_arts", "visual_poetry", "ya"];

 var mGenre = ["Бухучет и аудит", "Природа и животные", "Путешествия и география", "Исторические приключения", "Приключения про индейцев", "Морские приключения", "Приключения в современном мире", "Авантюрный роман", "Вестерн", "Приключения", "Старинная литература", "Античная литература", "Древневосточная литература", "Древнеевропейская литература", "Мифы, легенды, эпос", "Древнерусская литература", "Афоризмы, цитаты", "Архитектура и скульптура", "Искусствоведение", "Мировая художественная культура", "Астрология", "Автодело", "Автомобили и ПДД", "Банковское дело и финансы", "Приключения для детей и подростков", "Классическая детская литература", "Детская остросюжетная литература", "Детская образовательная литература", "Детский фольклор", "Проза для детей", "Фантастика для детей", "Сказки народов мира", "Русские сказки", "Стихи для детей", "Детская литература", "Кино", "Комедия", "Комиксы", "Базы данных", "Цифровая обработка сигналов", "Аппаратное обеспечение", "ОС и сети", "Программирование", "Программы", "Интернет", "Околокомпьютерная литература", "Искусство и дизайн", "Боевик", "Классический детектив", "Дамский детективный роман", "Криминальный детектив", "Шпионский детектив", "Крутой детектив", "Исторический детектив", "Иронический детектив", "Маньяки", "Полицейский детектив", "Политический детектив", "Советский детектив", "Детективы", "Диафильмы", "Антисоветская литература", "Драма", "Античная драма", "Драматургия", "Экономика", "Деловая литература", "Былины", "Эпическая поэзия", "Эпистолярная проза", "История техники", "Эссе, очерк, этюд, набросок", "Экспериментальная поэзия", "Феерия", "Басни", "Сказочная фантастика", "Семейные отношения", "Фанфик", "Народные песни", "Народные сказки", "Фольклор", "Средневековая классическая проза", "Зарубежная литература для детей", "Иностранные языки", "Зарубежная классическая проза", "Путеводители", "Внешняя торговля", "Готический роман", "Повесть", "Историческое фэнтези", "Домоводство", "Коллекционирование", "Кулинария", "Хобби и ремесла", "Сделай сам", "Развлечения", "Сад и огород", "Здоровье", "Домашние животные", "Эротика, секс", "Спорт", "Хроноопера", "Юмор", "Анекдоты", "Юмористическое фэнтези", "Юмористическая проза", "Сатира", "Юмористические стихи", "В стихах", "Отраслевые издания", "Поиск работы, карьера", "Частушки, прибаутки, потешки", "Классическая проза XVII-XVIII веков", "Классическая проза ХIX века", "Классическая проза ХX века", "О любви", "Современные любовные романы", "Любовные детективы", "Эротическая литература", "Порно", "Исторические любовные романы", "Любовная фантастика", "Короткие любовные романы", "Лирика", "Управление, подбор персонала", "Маркетинг, PR, реклама", "Военное дело", "Боевые искусства", "Военная история", "Спецслужбы", "Военная техника и вооружение", "Современная сказка", "Музыка", "Мистерия", "Самиздат, сетевая литература", "Биографии и мемуары", "Критика", "Военная документалистика", "Публицистика", "Документальная литература", "Партитуры", "Ненаучная фантастика", "Корпоративная культура", "Неотсортированное", "Живопись, альбомы, иллюстрированные каталоги", "Палиндромы", "Хиромантия", "Делопроизводство", "Газеты и журналы", "Личные финансы", "Поэма, эпическая поэзия", "Поэзия", "Классическая поэзия", "Поэзия Востока", "Классическая зарубежная поэзия", "Современная зарубежная поэзия", "Современная поэзия", "Классическая русская поэзия", "Современная русская поэзия", "Попаданцы /Флибуста/", "Попаданцы /Либрусек/", "О бизнесе популярно", "Проза", "Фантасмагория, абсурдистская проза", "Классическая проза", "Современная проза", "Контркультура", "Эпопея", "Книга-игра", "Историческая проза", "Магический реализм", "О войне", "Экспериментальная, неформатная проза", "Русская классическая проза", "Сентиментальная проза", "Советская классическая проза", "Пословицы, поговорки", "Детская психология", "Секс и семейная психология", "Психотерапия и консультирование", "Недвижимость", "Словари", "Энциклопедии", "Руководства", "Справочники", "Справочная литература", "Религиозная литература", "Буддизм", "Католицизм", "Христианство", "Эзотерика", "Индуизм", "Ислам", "Иудаизм", "Православие", "Язычество", "Протестантизм", "Религия", "Самосовершенствование", "Загадки", "Роман", "Славянское фэнтези", "Семейный роман, семейная сага", "Сценарии", "Рефераты", "Аналитическая химия", "Биохимия", "Биология", "Биофизика", "Ботаника", "Строительство и сопромат", "Деловая литература", "Химия", "Астрономия и космос", "Шпаргалки", "Культурология", "Экология", "Экономика", "Геология и география", "История", "Юриспруденция", "Языкознание", "Математика", "Медицина", "Альтернативная медицина", "Металлургия", "Органическая химия", "Востоковедение", "Педагогика и воспитание", "Литературоведение", "Философия", "Физика", "Физическая химия", "Политика", "Научно-популярная литература", "Психология", "Радиоэлектроника", "Религиоведение", "Обществознание, социология", "Государство и право", "Технические науки", "Учебники и пособия", "Альтернативные науки и научные теории", "Транспорт и авиация", "Ветеринария", "Зоология", "Научная литература", "Киносценарии", "Научная фантастика", "Боевая фантастика", "Киберпанк", "Детективная фантастика", "Эпическая фантастика", "Фантастика", "Фэнтези", "Городское фэнтези", "Ироническое фэнтези", "Героическая фантастика", "Альтернативная история", "Ужасы", "Юмористическая фантастика", "Ироническая фантастика", "ЛитРПГ", "Мистика", "Постапокалипсис", "Социальная фантастика", "Космическая фантастика", "Космоопера", "Стимпанк", "Технофэнтези", "Рассказ", "Малый бизнес", "Песенная поэзия", "Ценные бумаги, инвестиции", "Новелла", "Рыцарский роман", "Учебные пособия, самоучители", "Учебники и пособия ВУЗов", "Школьные учебники и пособия, рефераты, шпаргалки", "Учебники и пособия для среднего и специального образования", "Театр", "Триллер", "Юридический триллер", "Медицинский триллер", "Психологический триллер", "Техно триллер", "Торговля", "Трагедия", "География, путевые заметки", "Незавершенное", "Водевиль", "Верлибры", "Изобразительное искусство, фотография", "Визуальная поэзия", "Подростковая литература"];

 var LengthGenre =mCodeGenre.length;      //  Длина универсального списка жанров (295)

// ---------------------------------------------------
// ------------------------------------
// ---------------------


                 /// ФУНКЦИЯ ПОИСКА И ДОБАВЛЕНИЯ ЖАНРОВ

 var div;                   //  один из узлов "DIV"
 var bookGenre;   //  Один из жанров
 var Zhanry = "";   //  Список жаров
 var elemG;            //  Один из разделов жанра
 var mElem = [];   //  "Подставной" массив новых элементов с названиями жанров
 var elemAdd;      //  Новый элемент с названием жанра

         //  Функция для добавления названий жанров
 function Show() {
         Zhanry = "";
         for (j=0; j<mDiv.length; j++) {              //  Просмотр всех разделов "DIV" по очереди.
                 div = mDiv[j];
                 elemG = div.all.genre;                //  Получение раздела "INPUT" с именем "genre".
                 bookGenre = elemG.value;          //  Получение значения жанра.
                 if (bookGenre != "") {                                           //  Если значение не пустое...
                         for (k=0; k<LengthGenre; k++)                      //  то включаем просмотр всех известных кодов для жанра.
                                 if (mCodeGenre[k] == bookGenre) {         //  Если найден такой же код...
                                         if (Dobavlenie) {                                                                       //  Проверяем, можно ли добавить название жанра на панель "Описания документа", и если можно...
                                                 elemAdd = document.createElement("LABEL");                              //  создаем новый элемент,
                                                 mElem.push(elemAdd);                                                                                      //  сохраняем его в массиве,
                                                 elemG.nextSibling.insertAdjacentElement("afterEnd",  elemAdd);      //  вставляем новый элемент через один раздел после раздела "INPUT".
                                                 if (mGenre[k].length < 51  ||  div.getElementsByTagName("SPAN").length != 0)    //  Если название жанра короткое или есть место для длинного названия...
                                                         elemAdd.innerHTML = mGenre[k];                                                                        //  вставляем это название без изменений.
                                                     else  elemAdd.innerHTML = mGenre[k].replace(/^(.{49}).+/, "$1…");   //  Если нет -- вставляем укороченный вариант.
                                                 elemAdd.style.color="#005929";                                                                         //  Указываем цвет шрифта.
                                                 }
                                         bookGenre = mGenre[k];                      //  Затем полученное значение жанра из книги заменяем на обычное написание
                                         break;                                                            //  и выходим из цикла.
                                         }
                         Zhanry += " • " + bookGenre + "   \n";       //  Добавляем в список еще один жанр.
                         }
                 }
         }

// ---------------------------------------------------
// ------------------------------------
// ---------------------


                 /// ОКНО РЕЗУЛЬТАТОВ :  сборка, вывод

 var Txt2="ЖАНРЫ:\n\n";        //  Текст окна.

 if (Dobavlenie)   //  Если включено добавление названий на панель "Описания документа"...
         window.external.BeginUndoUnit(document,"«Показать жанры» v."+NumerusVersion);           // отмечаем начало записи в систему отмен.


         //  Обработка основных жанров

 var mDiv = mDesc.tiGenre.getElementsByTagName("DIV");  //  массив с узлами "DIV" (каждый узел посвящен одному жанру).
 Show();         //  Обработка основной функцией.

 if (Zhanry != "")                                                                       //  Если после обработки функцией, список с жанрами не пустой...
         Txt2 += Zhanry;    //  добавляем его к основному тексту.
     else Txt2 += "   <основной жанр не указан>   \n";   //  Если добавлять нечего, то пишем и об этом.


         //  Обработка жанров оригинала

 mDiv = mDesc.stiGenre.getElementsByTagName("DIV");  //  массив с узлами "DIV" (каждый узел посвящен одному жанру).
 Show();         //  Обработка основной функцией.

 if (Zhanry != "")                                                                       //  Если после обработки функцией, список с жанрами не пустой...
         Txt2 += "-----------------------------------------------   \n" + Zhanry;    //  добавляем его к основному тексту.


         //  Вывод окна со списками жанров

 MsgBox (Txt2);

// ---------------------------------------------------
// ------------------------------------
// ---------------------


                 /// УДАЛЕНИЕ ДОБАВЛЕННЫХ РАЗДЕЛОВ

 if (Dobavlenie) {   //  Если включено добавление названий на панель "Описания документа"...

         for (k=mElem.length-1; k>=0; k--)   //  Перебираем все добавленные разделы
                 mElem[k].removeNode(true);   //  и удаляем их всех по очереди.

         window.external.EndUndoUnit(document);    // Конец записи в систему отмен.
         }

// ---------------------------------------------------------------
// ----------------------------------------------
// -----------------------------

}



